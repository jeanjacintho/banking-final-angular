<div class="bg-white rounded-xl p-4 border border-border">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <div class="flex items-center gap-2">
            <lucide-icon name="ArrowRightLeft" size="20" class="text-primary"></lucide-icon>
            <span class="text-sm text-muted-foreground">Realizar Transferência</span>
        </div>
    </div>

    <div class="space-y-6">
        <!-- Account Selection -->
        <div class="bg-muted rounded-lg p-4 border border-border">
            <div class="text-xs text-muted-foreground mb-3">Selecione a conta de origem</div>
            <div class="space-y-3">
                <div *ngFor="let account of accounts"
                    class="flex items-center gap-4 p-3 bg-white rounded-lg border border-border cursor-pointer transition-colors hover:bg-muted"
                    [class.border-primary]="selectedFromAccount?.accountNumber === account.accountNumber"
                    [class.bg-primary/5]="selectedFromAccount?.accountNumber === account.accountNumber"
                    (click)="selectFromAccount(account)">

                    <!-- Icon -->
                    <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center">
                        <lucide-icon name="Wallet" size="20" class="text-primary"></lucide-icon>
                    </div>

                    <!-- Account Details -->
                    <div class="flex-1">
                        <div class="text-text text-sm font-semibold">{{ getAccountTypeLabel(account.accountType) }}
                        </div>
                        <div class="text-xs text-muted-foreground">{{ account.accountNumber }}</div>
                    </div>

                    <!-- Balance -->
                    <div class="text-right">
                        <div class="font-semibold text-text text-sm">{{ formatCurrency(account.balance) }}</div>
                        <div class="text-xs text-muted-foreground">Saldo</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transfer Form -->
        <div class="bg-white rounded-lg p-4 border border-border">
            <div class="text-xs text-muted-foreground mb-4">Dados da transferência</div>

            <div class="space-y-4">
                <!-- Selected Account Display -->
                <div *ngIf="selectedFromAccount" class="bg-muted rounded-lg p-3 border border-border">
                    <div class="text-xs text-muted-foreground mb-2">Conta selecionada</div>
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center">
                            <lucide-icon name="Wallet" size="18" class="text-primary"></lucide-icon>
                        </div>
                        <div class="flex-1">
                            <div class="text-sm font-semibold text-text">{{
                                getAccountTypeLabel(selectedFromAccount.accountType) }}</div>
                            <div class="text-xs text-muted-foreground">{{ selectedFromAccount.accountNumber }}</div>
                        </div>
                        <div class="text-sm font-semibold text-text">{{ formatCurrency(selectedFromAccount.balance) }}
                        </div>
                    </div>
                </div>

                <!-- Destination Account -->
                <div>
                    <label class="block text-xs text-muted-foreground mb-2">Conta de Destino</label>
                    <input type="text"
                        class="w-full px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 bg-white"
                        [(ngModel)]="toAccountNumber" (input)="onToAccountNumberChange()"
                        placeholder="Digite o número da conta" maxlength="20">

                    <div *ngIf="selectedToAccount" class="mt-3 p-3 bg-muted rounded-lg border border-border">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center">
                                <lucide-icon name="Wallet" size="18" class="text-primary"></lucide-icon>
                            </div>
                            <div class="flex-1">
                                <div class="text-sm font-semibold text-text">{{
                                    getAccountTypeLabel(selectedToAccount.accountType) }}</div>
                                <div class="text-xs text-muted-foreground">{{ selectedToAccount.accountNumber }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Amount -->
                <div>
                    <label class="block text-xs text-muted-foreground mb-2">Valor</label>
                    <input type="number"
                        class="w-full px-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 bg-white"
                        [(ngModel)]="transferAmount" placeholder="0,00" min="0.01" step="0.01">
                </div>

                <!-- Transfer Type -->
                <div>
                    <label class="block text-xs text-muted-foreground mb-2">Tipo de Transferência</label>
                    <div class="space-y-2">
                        <div *ngFor="let type of transferTypes"
                            class="flex items-center justify-between p-3 bg-muted rounded-lg border border-border cursor-pointer transition-colors hover:bg-muted/80"
                            [class.border-primary]="transferType === type.value"
                            [class.bg-primary/5]="transferType === type.value" (click)="transferType = type.value">

                            <div class="flex-1">
                                <div class="text-sm font-semibold text-text">{{ type.label }}</div>
                                <div class="text-xs text-muted-foreground">{{ type.description }}</div>
                            </div>
                            <div class="text-xs text-muted-foreground">{{ type.fee }}</div>
                        </div>
                    </div>
                </div>

                <!-- Transfer Summary -->
                <div *ngIf="transferAmount > 0" class="bg-muted rounded-lg p-4 border border-border">
                    <div class="text-xs text-muted-foreground mb-3">Resumo da transferência</div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-muted-foreground">Valor da transferência:</span>
                            <span class="font-semibold text-text">{{ formatCurrency(transferAmount) }}</span>
                        </div>
                        <div *ngIf="calculateTotalWithFee() > transferAmount" class="flex justify-between text-sm">
                            <span class="text-muted-foreground">Taxa:</span>
                            <span class="font-semibold text-text">{{ formatCurrency(calculateTotalWithFee() -
                                transferAmount) }}</span>
                        </div>
                        <div class="flex justify-between text-sm font-semibold border-t border-border pt-2">
                            <span class="text-text">Total a ser debitado:</span>
                            <span class="text-primary">{{ formatCurrency(calculateTotalWithFee()) }}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-muted-foreground">Saldo após transferência:</span>
                            <span class="font-semibold text-text">{{ formatCurrency((selectedFromAccount?.balance || 0)
                                - calculateTotalWithFee()) }}</span>
                        </div>
                    </div>
                </div>

                <!-- Error Message -->
                <div *ngIf="errorMessage"
                    class="px-4 py-3 rounded-lg text-sm bg-red-50 text-red-700 border border-red-200">
                    {{ errorMessage }}
                </div>

                <!-- Transfer Button -->
                <button
                    class="w-full bg-gradient-to-r from-gradient-start to-gradient-end text-white font-medium py-3.5 px-6 rounded-lg hover:brightness-105 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center shadow-sm"
                    [disabled]="isLoading || !selectedFromAccount || !toAccountNumber || transferAmount <= 0"
                    (click)="executeTransfer()">
                    <span *ngIf="!isLoading">Transferir</span>
                    <span *ngIf="isLoading" class="flex items-center">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg"
                            fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        Processando...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <div *ngIf="showSuccessModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
        (click)="closeSuccessModal()">
        <div class="bg-card border border-border rounded-xl p-8 text-center max-w-md w-11/12"
            (click)="$event.stopPropagation()">
            <div class="text-5xl mb-4">✅</div>
            <h3 class="text-2xl font-bold text-text mb-2">Transferência Realizada!</h3>
            <p class="text-text-light mb-6">{{ successMessage }}</p>
            <button
                class="bg-gradient-start text-white border-0 rounded-lg px-6 py-3 font-semibold cursor-pointer transition-all duration-200 hover:bg-gradient-end"
                (click)="closeSuccessModal()">Fechar</button>
        </div>
    </div>
</div>