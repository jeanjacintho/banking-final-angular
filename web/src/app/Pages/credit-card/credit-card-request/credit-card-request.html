<div class="min-h-screen p-8 bg-[color:var(--color-background)] text-[color:var(--color-text)]">
  <div class="max-w-5xl mx-auto space-y-8">
    <!-- Header -->
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-bold">Solicitar novo cartão</h1>
        <p class="text-sm mt-1 text-[color:var(--color-text-light)]">
          Preencha seus dados para analisarmos seu crédito.
        </p>
      </div>

      <a
        routerLink=".."
        class="inline-flex items-center gap-2 px-4 py-2 rounded-lg transition text-[color:var(--color-primary-foreground)] bg-[color:var(--color-primary)] hover:bg-[color:var(--color-primary-hover)] border border-[color:var(--color-border)] shadow-[var(--color-shadow)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)]"
      >
        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
        Voltar
      </a>
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-8">
      <!-- Dados pessoais -->
      <section
        class="rounded-xl p-6 shadow-[var(--shadow-sm)] bg-[color:var(--color-card)] text-[color:var(--color-card-foreground)] border border-[color:var(--color-border)]"
      >
        <h2 class="text-lg font-semibold mb-4">Dados pessoais</h2>

        <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
          <!-- Nome -->
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]"
              >Nome completo</label
            >
            <input
              formControlName="name"
              [class.border-[color:var(--color-destructive)]]="isInvalid(form.get('nomeCompleto'))"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
              placeholder="Seu nome"
            />
            <p
              *ngIf="isInvalid(form.get('nomeCompleto'))"
              class="mt-1 text-xs text-[color:var(--color-destructive)]"
            >
              Informe um nome com pelo menos 5 caracteres.
            </p>
          </div>

          <!-- CPF -->
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]">CPF</label>
            <input
              formControlName="cpf"
              [class.border-[color:var(--color-destructive)]]="isInvalid(form.get('cpf'))"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
              placeholder="000.000.000-00"
            />
            <p
              *ngIf="isInvalid(form.get('cpf'))"
              class="mt-1 text-xs text-[color:var(--color-destructive)]"
            >
              CPF inválido. Use o formato 000.000.000-00.
            </p>
          </div>

          <!-- Data nasc -->
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]"
              >Data de nascimento</label
            >
            <input
              type="date"
              formControlName="dateOfBirth"
              [class.border-[color:var(--color-destructive)]]="
                isInvalid(form.get('dataNascimento'))
              "
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            />
            <p
              *ngIf="isInvalid(form.get('dataNascimento'))"
              class="mt-1 text-xs text-[color:var(--color-destructive)]"
            >
              Data de nascimento é obrigatória.
            </p>
          </div>

          <!-- Email -->
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]">Email</label>
            <input
              type="email"
              formControlName="email"
              [class.border-[color:var(--color-destructive)]]="isInvalid(form.get('email'))"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
              placeholder="voce@exemplo.com"
            />
            <p
              *ngIf="isInvalid(form.get('email'))"
              class="mt-1 text-xs text-[color:var(--color-destructive)]"
            >
              Informe um email válido.
            </p>
          </div>

          <!-- Telefone -->
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]">Telefone</label>
            <input
              formControlName="phoneNumber"
              [class.border-[color:var(--color-destructive)]]="isInvalid(form.get('telefone'))"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
              placeholder="(00) 0000-0000"
            />
            <p
              *ngIf="isInvalid(form.get('telefone'))"
              class="mt-1 text-xs text-[color:var(--color-destructive)]"
            >
              Informe um telefone válido.
            </p>
          </div>
        </div>

        <!-- Endereço -->
        <div formGroupName="address" class="mt-6 grid grid-cols-1 gap-4 md:grid-cols-2">
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]"
              >Logradouro</label
            >
            <input
              formControlName="logradouro"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            />
          </div>
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]">Número</label>
            <input
              formControlName="numero"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            />
          </div>
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]"
              >Complemento</label
            >
            <input
              formControlName="complemento"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            />
          </div>
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]">Bairro</label>
            <input
              formControlName="bairro"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            />
          </div>
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]">Cidade</label>
            <input
              formControlName="cidade"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            />
          </div>
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]">Estado</label>
            <input
              formControlName="estado"
              maxlength="2"
              class="w-full uppercase rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            />
          </div>
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]">CEP</label>
            <input
              formControlName="cep"
              placeholder="0000-000"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            />
          </div>
        </div>
      </section>

      <!-- Dados financeiros -->
      <section
        class="rounded-xl p-6 shadow-[var(--shadow-sm)] bg-[color:var(--color-card)] text-[color:var(--color-card-foreground)] border border-[color:var(--color-border)]"
      >
        <h2 class="text-lg font-semibold mb-4">Dados financeiros</h2>

        <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]"
              >Renda mensal (R$)</label
            >
            <input
              type="number"
              formControlName="monthlyIncome"
              [class.border-[color:var(--color-destructive)]]="isInvalid(form.get('rendaMensal'))"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] border border-[color:var(--color-input)] placeholder:text-[color:var(--color-muted-foreground)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            />
            <p
              *ngIf="isInvalid(form.get('rendaMensal'))"
              class="mt-1 text-xs text-[color:var(--color-destructive)]"
            >
              Informe uma renda válida.
            </p>
          </div>

          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]"
              >Fonte de renda</label
            >
            <select
              formControlName="sourceIncome"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            >
              <option class="bg-[color:var(--color-card)]" value="CLT">CLT</option>
              <option class="bg-[color:var(--color-card)]" value="PJ">PJ</option>
              <option class="bg-[color:var(--color-card)]" value="Autonomo">Autônomo</option>
              <option class="bg-[color:var(--color-card)]" value="Aposentado">Aposentado</option>
              <option class="bg-[color:var(--color-card)]" value="Estudante">Estudante</option>
              <option class="bg-[color:var(--color-card)]" value="Outros">Outros</option>
            </select>
          </div>

          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]">Empresa</label>
            <input
              formControlName="company"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            />
          </div>

          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]"
              >Tempo de emprego (meses)</label
            >
            <input
              type="number"
              formControlName="employmentTimeMonths"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            />
          </div>
        </div>
      </section>

      <!-- Preferências e consentimentos -->
      <section
        class="rounded-xl p-6 shadow-[var(--shadow-sm)] bg-[color:var(--color-card)] text-[color:var(--color-card-foreground)] border border-[color:var(--color-border)]"
      >
        <h2 class="text-lg font-semibold mb-4">Preferências</h2>

        <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]"
              >Tipo de fatura</label
            >
            <select
              formControlName="invoiceType"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            >
              <option class="bg-[color:var(--color-card)]" value="digital">Digital</option>
              <option class="bg-[color:var(--color-card)]" value="papel">Papel</option>
            </select>
          </div>

          <div>
            <label class="block text-sm mb-1 text-[color:var(--color-text-light)]"
              >Dia de vencimento</label
            >
            <input
              type="number"
              min="1"
              max="28"
              formControlName="preferredDueDate"
              class="w-full rounded-lg px-3 py-2 bg-[color:var(--color-card)] text-[color:var(--color-text)] placeholder:text-[color:var(--color-muted-foreground)] border border-[color:var(--color-input)] focus:border-[color:var(--color-ring)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-ring)] shadow-[var(--color-shadow)]"
            />
          </div>
        </div>

        <hr class="my-6 border-[color:var(--color-border)]" />

        <h2 class="text-lg font-semibold mb-3">Consentimentos</h2>
        <div class="space-y-3">
          <label class="flex items-center gap-3">
            <input
              type="checkbox"
              formControlName="acceptTerms"
              class="h-4 w-4 rounded bg-[color:var(--color-card)] text-[color:var(--color-primary)] border border-[color:var(--color-input)] focus:ring-[color:var(--color-ring)]"
            />
            <span class="text-sm text-[color:var(--color-text-light)]"
              >Declaro que li e aceito os termos.</span
            >
          </label>
          <label class="flex items-center gap-3">
            <input
              type="checkbox"
              formControlName="authorizationCreditConsultation"
              class="h-4 w-4 rounded bg-[color:var(--color-card)] text-[color:var(--color-primary)] border border-[color:var(--color-input)] focus:ring-[color:var(--color-ring)]"
            />
            <span class="text-sm text-[color:var(--color-text-light)]"
              >Autorizo consulta aos bureaus de crédito.</span
            >
          </label>
        </div>
      </section>

      <!-- Ações -->
      <div class="flex items-center gap-3">
        <button
          type="submit"
          [disabled]="form.invalid || loading()"
          class="inline-flex items-center justify-center px-5 py-2.5 rounded-lg transition text-[color:var(--color-primary-foreground)] bg-[color:var(--color-primary)] hover:bg-[color:var(--color-primary-hover)] border border-[color:var(--color-border)] shadow-[var(--color-shadow)] disabled:cursor-not-allowed disabled:opacity-60"
        >
          <svg
            *ngIf="loading()"
            class="mr-2 h-4 w-4 animate-spin text-[color:var(--color-primary-foreground)]"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
            ></path>
          </svg>
          Enviar solicitação
        </button>

        <span *ngIf="form.invalid" class="text-sm text-[color:var(--color-text-light)]"
          >Preencha os campos obrigatórios.</span
        >
      </div>
    </form>

    <!-- Resultado -->
    <section
      *ngIf="result() as r"
      class="rounded-xl p-6 shadow-[var(--shadow-sm)] bg-[color:var(--color-card)] text-[color:var(--color-card-foreground)] border border-[color:var(--color-border)]"
    >
      <h2 class="text-lg font-semibold mb-3">Resultado da solicitação</h2>
      <p class="text-sm text-[color:var(--color-text-light)]">
        Status:
        <span class="font-medium text-[color:var(--color-text)]">{{ r.statusSolicitacao }}</span>
      </p>

      <div
        *ngIf="r.statusSolicitacao !== 'recusado'"
        class="mt-3 grid grid-cols-1 gap-3 md:grid-cols-2"
      >
        <p class="text-sm text-[color:var(--color-text-light)]">
          Limite aprovado:
          <span class="font-medium text-[color:var(--color-text)]">{{
            r.limiteAprovado | currency : 'BRL'
          }}</span>
        </p>
        <p class="text-sm text-[color:var(--color-text-light)]">
          Bandeira:
          <span class="font-medium text-[color:var(--color-text)]">{{ r.brand }}</span>
        </p>
        <p class="text-sm text-[color:var(--color-text-light)]">
          Cartão:
          <span class="font-medium text-[color:var(--color-text)]">{{ r.maskedPan }}</span>
        </p>
        <p class="text-sm text-[color:var(--color-text-light)]">
          Vencimento da fatura:
          <span class="font-medium text-[color:var(--color-text)]">{{
            r.dataVencimentoFatura
          }}</span>
        </p>
      </div>

      <div *ngIf="r.pendencias?.length" class="mt-3">
        <p class="text-sm font-medium text-[color:var(--color-text)]">Pendências:</p>
        <ul class="mt-1 list-disc pl-5 text-sm text-[color:var(--color-text-light)]">
          <li *ngFor="let p of r.pendencias">{{ p }}</li>
        </ul>
      </div>

      <p *ngIf="r.mensagem" class="mt-3 text-sm text-[color:var(--color-text-light)]">
        {{ r.mensagem }}
      </p>
    </section>
  </div>
</div>
