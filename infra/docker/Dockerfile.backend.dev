FROM eclipse-temurin:17-jdk-alpine

WORKDIR /app

# Install curl for health checks (Alpine uses apk instead of apt-get)
RUN apk add --no-cache curl

# Copy Maven wrapper and pom.xml
COPY api/mvnw .
COPY api/.mvn .mvn
COPY api/pom.xml .

RUN chmod +x ./mvnw

# Download dependencies
RUN ./mvnw dependency:go-offline -B

# Copy source code for hot reload
COPY api/src ./src

EXPOSE 8080

CMD ["./mvnw", "spring-boot:run", "-Dspring-boot.run.jvmArguments=-Dspring.profiles.active=development -Djava.security.egd=file:/dev/./urandom"]